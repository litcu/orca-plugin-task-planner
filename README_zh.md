# orca-task-planner

[![English](https://img.shields.io/badge/README-English-1f6feb)](README.md)
[![简体中文](https://img.shields.io/badge/README-%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87-2ea44f)](README_zh.md)

`orca-task-planner` 是一个 Orca Note 的任务管理插件。

## 插件简介

这个插件面向“任务多、且执行顺序重要”的使用场景。

它可以帮助你：

- 快速把普通块变成任务
- 用时间、依赖、回顾、重复规则规划任务
- 在 **激活任务** 中专注当前可执行任务
- 用评分排序明确优先级
- 在一个面板里完成执行、计划和回顾

## 主要功能

### 0）任务快速收集（快速新增任务块）

在 GTD 流程中，“先收集、后整理”非常关键。  
插件支持在笔记中快速收集任务，尽量降低记录成本：

- 在编辑区可直接把当前块快速转为任务（`Alt+Enter`）；
- 在任务管理面板可通过“添加任务”快速新增任务块；
- 新增后可继续在属性面板补充时间、依赖、优先级等信息。

这使你可以先把任务捕获下来，再在后续统一整理和排程。

### 1）任务状态快速切换

插件提供高频、低摩擦的状态切换方式：

- 在任意块按 `Alt+Enter` 可直接创建任务，并循环切换状态；
- 中文状态顺序为：`待开始 -> 进行中 -> 已完成 -> 待开始`；
- 点击任务左侧状态图标也可执行同样切换；
- 切换为“进行中”时，会自动记录开始时间，便于后续跟踪。

这使得任务录入和执行切换可以在编辑流中完成，无需额外跳转。

### 2）任务属性面板：快速编辑任务属性

点击任务标签即可打开属性面板，集中编辑任务关键字段：

- 基础字段：状态、开始时间、到期时间、标签、备注、收藏；
- 计划字段：重要性、紧急度、工作量；
- 依赖字段：依赖任务、依赖模式（`ALL` / `ANY`）、依赖延迟；
- 周期字段：回顾规则、重复规则。

面板支持数值校验与快速保存，避免非法输入影响任务数据质量；依赖任务可通过块引用方式选择，适合维护复杂任务网络。

### 3）任务管理面板：统一查看与管理所有任务

插件实现了一个统一的任务管理面板，用于查看、筛选、编辑和维护任务全局状态。  
主要视图包括：

- **仪表盘**：全局概览（完成率、到期压力、阻塞项、优先任务）；
- **激活任务**：当前可执行任务清单（主执行入口）；
- **全部任务**：完整任务树（支持层级整理与拖拽）；
- **收藏任务**：人工标记的重点任务；
- **即将到期**：时间窗口内到期任务；
- **回顾**：待回顾任务与批量回顾操作；
- **自定义视图**：按规则保存的场景化视图。

在此面板中，你可以完成“查看 -> 调整 -> 执行 -> 复盘”的完整闭环。

### 4）激活任务：基于 GTD 思路的执行清单

在 GTD（Getting Things Done）方法中，核心是始终明确“下一步可以做什么”。  
`激活任务` 正是这一思想在插件中的落地：只展示当前可执行任务，避免在全量任务中反复筛选。

#### 判定规则

任务进入 `激活任务` 需要同时满足：

1. 任务未完成且未取消；
2. 已到开始时间（或未设置开始时间）；
3. 不存在未完成子任务；
4. 祖先依赖链不阻塞；
5. 本任务依赖条件满足（`ALL` / `ANY` + 延迟）。

#### 优先级评分公式

激活任务按以下公式评分并排序：

```text
Score = 0.40*Importance + 0.25*Urgency + 0.20*DueFactor + 0.10*StartFactor + 0.05*100
```

排序规则：

1. 分数降序；
2. 到期时间升序；
3. 内部稳定 ID 顺序。

#### 建议使用方式

- 每日开始工作时，先查看 `激活任务`；
- 优先处理列表前部任务，减少切换成本；
- 配合 `即将到期` 视图做短期排程，配合 `仪表盘` 做全局校准。

### 5）重复任务功能

插件支持结构化重复规则，适用于例行任务与周期任务：

- 支持按天/周/月重复；
- 支持间隔、指定周几（按周）、最大次数、结束日期；
- 任务完成后，系统会自动推进到下一周期；
- 对有层级的任务，可同步推进相关子任务状态与时间节奏。

这让周期任务管理从“手动复制”转为“规则驱动”。

### 6）任务回顾功能

回顾功能用于建立稳定复盘节奏，避免长期任务被遗忘：

- 支持单次回顾和周期回顾；
- 可配置回顾频率（如每 N 天/周/月）；
- 在 `回顾` 视图中集中处理待回顾任务；
- 支持批量“标记已回顾”，自动推进下一次回顾时间。

### 7）自定义视图功能

自定义视图用于将常用筛选场景固化为可复用入口：

- 支持创建、编辑、删除视图；
- 支持 AND/OR 组合条件；
- 可按状态、时间、依赖、标签等字段组合筛选；
- 视图会持久保存，重启后仍可直接使用。

适用于“工作/家庭/项目阶段/周计划”等长期场景分组。

### 8）任务仪表盘

`仪表盘` 提供任务系统的宏观监控能力：

- 关键指标：任务总量、激活任务、回顾任务、超期任务；
- 结构指标：状态分布、到期压力；
- 风险指标：主要阻塞原因；
- 执行指标：高优先激活任务列表。

它用于快速判断当前任务系统是否健康，并辅助你做节奏调整。

## 安装方式

### 从源码安装

1. 将项目放到 Orca 插件目录，例如：  
   `C:\Users\<你的用户名>\Documents\orca\plugins\orca-task-planner`
2. 构建：

```bash
npm install
npm run build
```

3. 启动/重启 Orca Note。
4. 在插件设置中启用 `orca-task-planner`。

构建产物：`dist/index.js`。

## 快速上手

1. 打开命令面板，执行 `Open Task Views Panel`。
2. 创建任务：
   - 把光标放到任意块
   - 按 `Alt+Enter`
   - 状态循环：`待开始 -> 进行中 -> 已完成 -> 待开始`
3. 打开任务属性：
   - 点击任务标签，或
   - 执行 `Open task properties`（中文界面通常显示为“打开任务属性”）
4. 配置核心字段：
   - 开始时间 / 到期时间
   - 依赖模式（`ALL` 或 `ANY`）
   - 依赖延迟（如需要）
   - 重要性 / 紧急度 / 工作量
5. 切到 **激活任务**，按列表顺序执行。
6. 在 `全部任务` 管理层级与拖拽结构。
7. 在 `回顾` 做周期回顾并批量标记。
8. 在 `即将到期` 和 `仪表盘` 做周期计划与总览。

## 命令与快捷键

- `Alt+Enter`：创建任务 / 循环切换任务状态
- `Open Task Views Panel`：打开任务管理面板
- `Toggle Task Views Panel`：显示 / 隐藏任务管理面板
- `Open task properties`：打开任务属性面板

## 数据与持久化

- 面向用户的任务字段存储在任务标签属性中
- 扩展规划字段存储在任务内部元数据中
- 自定义视图存储在插件本地数据中
- 核心功能不依赖外部服务

## 常见问题

### 为什么任务没出现在激活任务？

最常见原因：

- 开始时间还没到
- 依赖任务未完成
- 依赖延迟尚未结束
- 祖先依赖仍阻塞
- 仍有未完成子任务
- 任务已完成/已取消

### 为什么激活任务排序会变化？

当任务字段或依赖状态变化时（如到期时间、紧急度、依赖完成状态），评分会自动更新，排序会随之变化。

### 依赖模式 `ALL` 和 `ANY` 如何选择？

- `ALL`：所有前置都完成后才能开始
- `ANY`：任一前置完成即可开始

### 可以修改任务标签名称吗？

可以，在插件设置里修改 **任务标签名称**。

### 如何调整“即将到期”范围？

在插件设置中调整：

- **即将到期天数**
- **即将到期包含超期任务**

## 开发

```bash
npm install
npm run dev
npm run build
```
